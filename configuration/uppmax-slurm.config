/*
 * -------------------------------------------------
 * Nextflow config file for SarGet
 * -------------------------------------------------
 * Slurm configuration for UPPMAX clusters
 * -------------------------------------------------
 */

params {
  genome_base = params.genome == 'GRCh37' ? '/sw/data/uppnex/ToolBox/ReferenceAssemblies/hg38make/bundle/2.8/b37' : params.genome == 'GRCh38' ? '/sw/data/uppnex/ToolBox/hg38bundle' : 'References/smallGRCh37'
  runTime       = 48.h
  singleCPUMem  = 7.GB // for processes that are using more memory but a single CPU only. Use the 'core' queue for these
}

process {
  clusterOptions = {"-A $params.project"}
  cpus = 16
  executor = 'slurm'
  memory = 110.GB
  queue = 'node'
  scratch = true
  time = 48.h

  errorStrategy = {task.exitStatus == 143 ? 'retry' : 'terminate'}
  maxErrors = '-1'
  maxRetries = 3

    withName:RunFastQC {
        cpus = 2 // FastQC is only capable of running one thread per fastq file.
        errorStrategy = { task.exitStatus == 143 ? 'retry' : 'ignore' }
    }
    withName:TrimReads {
        cpus = 4
    }
    withName:AddUMIs {
        cpus = 4
    }
    withName:VariantCallingUMI {
        queue = 'core'
        cpus = 1
        memory = {params.singleCPUMem * 2 * task.attempt}
    }
    withName:siftAddCosmic {
    }
    withName:finishVCF {
    }
    withName:MapReads {
        time = {params.runTime * task.attempt}
    }
    withName:RunVEP {
        cpus = 1
        errorStrategy = { task.exitStatus == 143 ? 'retry' : 'ignore' }
    }

}